From 4278afc2794728ca148c9c232733945f610a5876 Mon Sep 17 00:00:00 2001
From: Yuuria <yuuria_sakura@proton.me>
Date: Thu, 7 Mar 2024 19:16:42 +0700
Subject: Modrinth and few patches

---
 .idea/.name                                                   | 1 +
 build.gradle                                                  | 2 ++
 buildECJjca                                                   | 0
 src/main/groovy/portb/submoduleplugin/Repo.groovy             | 4 ++--
 src/main/groovy/portb/submoduleplugin/SubmodulesPlugin.groovy | 1 +
 5 files changed, 6 insertions(+), 2 deletions(-)
 create mode 100644 .idea/.name
 create mode 100644 buildECJjca

diff --git a/.idea/.name b/.idea/.name
new file mode 100644
index 0000000..b4ac1b4
--- /dev/null
+++ b/.idea/.name
@@ -0,0 +1 @@
+ModSubmoduleBuildFromSource
\ No newline at end of file
diff --git a/build.gradle b/build.gradle
index 8bf9f60..82f5def 100644
--- a/build.gradle
+++ b/build.gradle
@@ -27,6 +27,7 @@ gradlePlugin {
 
 publishing {
     // other settings of publication
+    if (System.env['CODEBERG_AUTH_TOKEN']) {
         repositories {
             maven {
                 name = "Codeberg"
@@ -43,3 +44,4 @@ publishing {
             }
         }
     }
+}
\ No newline at end of file
diff --git a/buildECJjca b/buildECJjca
new file mode 100644
index 0000000..e69de29
diff --git a/src/main/groovy/portb/submoduleplugin/Repo.groovy b/src/main/groovy/portb/submoduleplugin/Repo.groovy
index c8721e9..f17f2db 100644
--- a/src/main/groovy/portb/submoduleplugin/Repo.groovy
+++ b/src/main/groovy/portb/submoduleplugin/Repo.groovy
@@ -114,7 +114,7 @@ class Repo {
         println("===== BUILD ${directory.fileName} =====")
 
         def repo = Grgit.open{
-            dir = directory
+            // dir = directory
             currentDir = directory
         }
 
@@ -140,7 +140,7 @@ class Repo {
                 commandOption = "/c"
                 gradlewPrefix = ""
             }
-
+            println("${gradlewPrefix}gradlew ${options.gradleArgs} ${options.tasks.join(" ")} _create_sources_jar")
             args commandOption, "${gradlewPrefix}gradlew ${options.gradleArgs} ${options.tasks.join(" ")} _create_sources_jar"
 
             ignoreExitValue options.ignoreErrors
diff --git a/src/main/groovy/portb/submoduleplugin/SubmodulesPlugin.groovy b/src/main/groovy/portb/submoduleplugin/SubmodulesPlugin.groovy
index 88454a0..7ae9ad3 100644
--- a/src/main/groovy/portb/submoduleplugin/SubmodulesPlugin.groovy
+++ b/src/main/groovy/portb/submoduleplugin/SubmodulesPlugin.groovy
@@ -67,6 +67,7 @@ class SubmodulesPlugin implements Plugin<Project> {
                     def dep
 
                     if (!repo.isDeobfEnabled) {
+                        repo.getJar()
                         //have to do this because fg.deobf doesn't support files(...)
                         project.repositories {
                             flatDir {
-- 
2.44.0.windows.1


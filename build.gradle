buildscript {
    repositories {
        maven { url = 'https://maven.minecraftforge.net' }
        maven { url = 'https://repo.spongepowered.org/repository/maven-public/' }
        mavenCentral()
    }
    dependencies {
        classpath group: 'net.minecraftforge.gradle', name: 'ForgeGradle', version: '5.1.+', changing: true
        classpath 'org.spongepowered:mixingradle:0.7-SNAPSHOT'
    }
}

plugins {
    id 'eclipse'
    id 'maven-publish'
}

apply plugin: 'net.minecraftforge.gradle'
apply plugin: 'org.spongepowered.mixin'

version = '1.16.5-1.0'
group = 'PORTB'
archivesBaseName = 'biggerstacks'

java.toolchain.languageVersion = JavaLanguageVersion.of(8)

println "Java: ${System.getProperty 'java.version'}, JVM: ${System.getProperty 'java.vm.version'} (${System.getProperty 'java.vendor'}), Arch: ${System.getProperty 'os.arch'}"

minecraft {
    mappings channel: 'official', version: '1.16.5'

    // accessTransformer = file('src/main/resources/META-INF/accesstransformer.cfg')

    runs {
        client {
            workingDirectory project.file('run')

            property 'forge.logging.markers', 'REGISTRIES'
            property 'forge.logging.console.level', 'debug'
            property 'forge.enabledGameTestNamespaces', 'biggerstacks'

            args(["--username", "Dev###"])

            mods {
                biggerstacks {
                    source sourceSets.main
                }
            }
        }

        server {
            workingDirectory project.file('serverrun')

            property 'forge.logging.markers', 'REGISTRIES'
            property 'forge.logging.console.level', 'debug'
            property 'forge.enabledGameTestNamespaces', 'biggerstacks'

            mods {
                biggerstacks {
                    source sourceSets.main
                }
            }
        }

        gameTestServer {
            workingDirectory project.file('gametestrun')

            property 'forge.logging.markers', 'REGISTRIES'
            property 'forge.logging.console.level', 'debug'
            property 'forge.enabledGameTestNamespaces', 'biggerstacks'

            mods {
                biggerstacks {
                    source sourceSets.main
                }
            }
        }

        data {
            workingDirectory project.file('datarun')

            property 'forge.logging.markers', 'REGISTRIES'
            property 'forge.logging.console.level', 'debug'
            args '--mod', 'biggerstacks', '--all', '--output', file('src/generated/resources/'), '--existing', file('src/main/resources/')

            mods {
                biggerstacks {
                    source sourceSets.main
                }
            }
        }
    }
}

mixin {
    add sourceSets.main, "biggerstacks.refmap.json"

    config "biggerstacks.mixins.json"
}

sourceSets.main.resources { srcDir 'src/generated/resources' }

repositories {
    mavenCentral()

    maven { // IE & CT
        name = "BlameJared"
        url = "https://maven.blamejared.com/"
    }
    maven { // JEI
        name 'DVS1 Maven FS'
        url 'https://dvs1.progwml6.com/files/maven'
    }
    maven { //Applied energy sticks 2
        url = uri("https://maven.pkg.github.com/AppliedEnergistics/Applied-Energistics-2")
        credentials {
            username = "github_is_stupid"
            password = "\u0067hp_oGjcD" /*im blue daba de daba di*/ + "FCn8jeTzIj4Ke9pLoEVtpnZMP4VQgaX"
        }
    }
    maven {
        url "https://cursemaven.com"
        content {
            includeGroup "curse.maven"
        }
    }
}

dependencies {
    minecraft 'net.minecraftforge:forge:1.16.5-36.2.35'

    //@formatter:off
    def cm = "curse.maven"

    var jei                     = "mezz.jei:jei-1.16.5:7.7.1.152"
    var ae2                     = "appeng:appliedenergistics2:8.4.7"
    var ie                      = "blusunrize.immersiveengineering:ImmersiveEngineering:1.16.5-5.1.0-148"
    var ct                      = "com.blamejared.crafttweaker:CraftTweaker-1.16.5:7.1.2.511" //used for testing blacklist/whitelist tag

    var refinedStorage         = "$cm:RefinedStorage-243076:3807951"         //https://www.curseforge.com/minecraft/mc-mods/refined-storage/files/
    var cyclic                 = "$cm:Cyclic-239286:3717822"                 //https://www.curseforge.com/minecraft/mc-mods/cyclic/files
    var mcJtyLib               = "$cm:McJtyLib-233105:3813653"               //https://www.curseforge.com/minecraft/mc-mods/mcjtylib/files (mcjty probably has a maven but i can't be bothered + if it aint broke dont fix it)
    var rftoolsBase            = "$cm:RFToolsBase-326041:3813654"            //https://www.curseforge.com/minecraft/mc-mods/rftools-base/files
    var rftoolsStorage         = "$cm:RFToolsStorage-350006:3771411"         //https://www.curseforge.com/minecraft/mc-mods/rftools-storage/files
    var rftoolsUtility         = "$cm:RFToolsUtility-342466:3813656"         //https://www.curseforge.com/minecraft/mc-mods/rftools-utility/files
    var xnet                   = "$cm:XNet-260912:3813662"                   //https://www.curseforge.com/minecraft/mc-mods/xnet/files
    var dimStorage             = "$cm:DimStorage-353882:3335450"             //https://www.curseforge.com/minecraft/mc-mods/dimstorage/files
    var prettyPipes            = "$cm:PrettyPipes-376737:3724799"            //https://www.curseforge.com/minecraft/mc-mods/pretty-pipes/files
    var colossalChests         = "$cm:ColossalChests-237875:3474923"         //https://www.curseforge.com/minecraft/mc-mods/colossal-chests/files
    var cyclopsCore            = "$cm:CyclopsCore-232758:3796009"            //https://www.curseforge.com/minecraft/mc-mods/cyclops-core/files
    var modularRouters         = "$cm:ModularRouters-250294:3622942"         //https://www.curseforge.com/minecraft/mc-mods/modular-routers/files
    var sophisticatedBackpacks = "$cm:SophisticatedBackpacks-422301:3699214" //https://www.curseforge.com/minecraft/mc-mods/sophisticated-backpacks/files/
    //@formatter:on

    implementation fg.deobf(jei)
    implementation fg.deobf(ae2)
    implementation fg.deobf(ie)
    implementation fg.deobf(ct)

    implementation fg.deobf(refinedStorage)
    implementation fg.deobf(modularRouters)
    implementation fg.deobf(cyclic)
    implementation fg.deobf(mcJtyLib)
    implementation fg.deobf(rftoolsUtility)
    implementation fg.deobf(rftoolsBase)
    implementation fg.deobf(rftoolsStorage)
    implementation fg.deobf(xnet)
    implementation fg.deobf(dimStorage)
    implementation fg.deobf(prettyPipes)
    implementation fg.deobf(colossalChests)
    implementation fg.deobf(cyclopsCore)
    implementation fg.deobf(sophisticatedBackpacks)

    annotationProcessor 'org.spongepowered:mixin:0.8.5:processor'
}

jar {
    manifest {
        attributes([
                "Specification-Title"     : "biggerstacks",
                //"Specification-Vendor"    : "biggerstackssareus",
                "Specification-Version"   : "1", // We are version 1 of ourselves
                "Implementation-Title"    : project.name,
                "Implementation-Version"  : project.jar.archiveVersion.get(),
                //"Implementation-Vendor"   : "biggerstackssareus",
                "Implementation-Timestamp": new Date().format("yyyy-MM-dd'T'HH:mm:ssZ")
        ])
    }
}

jar.finalizedBy('reobfJar')

tasks.withType(JavaCompile).configureEach {
    options.encoding = 'UTF-8' // Use the UTF-8 charset for Java compilation
}
